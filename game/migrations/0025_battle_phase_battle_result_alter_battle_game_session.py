# Generated by Django 4.2.1 on 2023-06-21 20:31

from django.db import migrations, models
import django.db.models.deletion


def set_phase(apps, schema_editor):
    Battle = apps.get_model("game", "Battle")
    for battle in Battle.objects.all():
        battle.phase = "F"
        battle.save()


def set_result(apps, schema_editor):
    Battle = apps.get_model("game", "Battle")
    for battle in Battle.objects.all():
        if battle.attacker_strenght > battle.defender_strenght:
            battle.result = "W"
        else:
            battle.result = "L"
        battle.save()


class Migration(migrations.Migration):
    dependencies = [
        ("game", "0024_battle_game_session"),
    ]

    operations = [
        migrations.AddField(
            model_name="battle",
            name="phase",
            field=models.CharField(
                choices=[("O", "Ongoing"), ("R", "Returning"), ("F", "Finished")],
                default="O",
                max_length=1,
            ),
        ),
        migrations.AddField(
            model_name="battle",
            name="result",
            field=models.CharField(choices=[("W", "Win"), ("L", "Lose")], max_length=1, null=True),
        ),
        migrations.AlterField(
            model_name="battle",
            name="game_session",
            field=models.ForeignKey(
                null=True,
                on_delete=django.db.models.deletion.CASCADE,
                related_name="battles",
                to="game.gamesession",
            ),
        ),
        migrations.RunPython(set_phase),
        migrations.RunPython(set_result),
    ]
